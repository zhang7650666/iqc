<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Page title -->
    <title>新建表单</title>

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <!--<link rel="shortcut icon" type="image/ico" href="favicon.ico" />-->

    <!-- Vendor styles -->
    <link rel="stylesheet" href="vendor/fontawesome/css/font-awesome.css" />
    <link rel="stylesheet" href="vendor/metisMenu/dist/metisMenu.css" />
    <link rel="stylesheet" href="vendor/animate.css/animate.css" />
    <link rel="stylesheet" href="vendor/bootstrap/dist/css/bootstrap.css" />
    <link rel="stylesheet" href="vendor/sweetalert/lib/sweet-alert.css" />
    <link rel="stylesheet" href="vendor/toastr/build/toastr.min.css" />
    <!-- <link
      rel="stylesheet"
      href="vendor/datatables.net-bs/css/dataTables.bootstrap.min.css"
    /> -->

    <link
      rel="stylesheet"
      href="vendor/bootstrap-datepicker-master/dist/css/bootstrap-datepicker3.min.css"
    />
    <!-- <link
      rel="stylesheet"
      href="vendor/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css"
    /> -->
    <link
      rel="stylesheet"
      href="vendor/clockpicker/dist/bootstrap-clockpicker.min.css"
    />
    <link
      rel="stylesheet"
      href="vendor/eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css"
    />

    <!-- App styles -->
    <link
      rel="stylesheet"
      href="fonts/pe-icon-7-stroke/css/pe-icon-7-stroke.css"
    />
    <link rel="stylesheet" href="fonts/pe-icon-7-stroke/css/helper.css" />
    <link rel="stylesheet" href="styles/style.css" />
    <link rel="stylesheet" href="styles/flex.css" />
  </head>
  <body class="fixed-navbar fixed-sidebar">
    <!--[if lt IE 7]>
      <p class="alert alert-danger">
        You are using an <strong>outdated</strong> browser. Please
        <a href="http://browsehappy.com/">upgrade your browser</a> to improve
        your experience.
      </p>
    <![endif]-->

    <!-- Header -->
    <div id="header">
      <div class="color-line"></div>
      <!-- 常屏 项目名 -->
      <div id="logo" class="light-version">
        <span> 材料检验客户端 </span>
      </div>

      <!--  小屏 顶部导航 -->
      <nav role="navigation">
        <div class="header-link hide-menu"><i class="fa fa-bars"></i></div>
        <div class="small-logo">
          <span class="text-primary">材料检验客户端</span>
        </div>
        <div class="mobile-menu">
          <button
            type="button"
            class="navbar-toggle mobile-menu-toggle"
            data-toggle="collapse"
            data-target="#mobile-collapse"
          >
            <i class="fa fa-chevron-down"></i>
          </button>
          <div class="collapse mobile-navbar" id="mobile-collapse">
            <ul class="nav navbar-nav">
              <!-- <li>
                <a class="" href="login.html">Login</a>
              </li> -->
              <li>
                <a type="button" class="btn btn-text logoutBtn">Logout</a>
              </li>
            </ul>
          </div>
        </div>
        <!-- 面包线 -->
        <div id="hbreadcrumb">
          <ol class="hbreadcrumb breadcrumb">
            <li><a href="index-y.html">首页</a></li>
            <li class="active">
              <span>新建表单</span>
            </li>
          </ol>
        </div>
        <!-- 常屏 顶部导航 -->
        <div class="navbar-right">
          <ul class="nav navbar-nav no-borders">
            <li class="word-no-wp">
              <span>工程编号：</span>
              <span class="word-no"></span>
            </li>
            <li class="dropdown">
              <a type="button" class="btn btn-text logoutBtn">
                <i class="pe-7s-upload pe-rotate-90"></i>
              </a>
            </li>
          </ul>
        </div>
      </nav>
    </div>

    <!-- Navigation -->
    <aside id="menu">
      <div id="navigation">
        <ul class="nav" id="side-menu"></ul>
      </div>
    </aside>

    <!-- Main Wrapper -->
    <div id="wrapper">
      <div class="content animate-panel">
        <div class="hpanel">
          <div class="panel-body">
            <ul id="unit-info-box" class="l-s-n line34"></ul>
          </div>
        </div>

        <!-- 见证记录 -->
        <div class="hpanel print-wp">
          <div class="panel-heading"></div>
          <div class="panel-body">
            <div
              class="p-m"
              style="position: absolute; top: 0px; right: 0px; z-index: 99"
            >
              <button
                type="button"
                class="btn btn-primary print-hide pull-right query-other-form"
              >
                查看其它表单
              </button>
            </div>
            <h3 class="txt-center p-b-lg create-form-z">新建表单</h3>
            <form
              action="#"
              id="formData"
              class="form-horizontal label-right create_form_reset"
            >
              <div class="row create-item"></div>
              <div class="p-t-md txt-center">
                <button type="button" class="btn btn-info btn-back">
                  返回列表
                </button>
                <!-- <button type="reset" class="btn btn-default reset-form m-l-lg">
                  重置表单
                </button> -->
                <button type="submit" class="btn btn-primary m-l-lg">
                  新建表单
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Vendor scripts -->
    <script src="vendor/jquery/dist/jquery.min.js"></script>
    <script src="vendor/jquery-ui/jquery-ui.min.js"></script>
    <script src="vendor/slimScroll/jquery.slimscroll.min.js"></script>
    <script src="vendor/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="vendor/jquery-flot/jquery.flot.js"></script>
    <script src="vendor/jquery-flot/jquery.flot.resize.js"></script>
    <script src="vendor/jquery-flot/jquery.flot.pie.js"></script>
    <script src="vendor/flot.curvedlines/curvedLines.js"></script>
    <script src="vendor/jquery.flot.spline/index.js"></script>
    <script src="vendor/metisMenu/dist/metisMenu.min.js"></script>
    <script src="vendor/iCheck/icheck.min.js"></script>
    <script src="vendor/peity/jquery.peity.min.js"></script>
    <script src="vendor/sparkline/index.js"></script>
    <script src="vendor/sweetalert/lib/sweet-alert.min.js"></script>
    <script src="vendor/toastr/build/toastr.min.js"></script>
    <script src="vendor/moment/moment.js"></script>
    <script src="vendor/bootstrap-datepicker-master/dist/js/bootstrap-datepicker.min.js"></script>
    <script src="vendor/clockpicker/dist/bootstrap-clockpicker.min.js"></script>
    <script src="vendor/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
    <script src="vendor/jquery-validation/jquery.validate.min.js"></script>
    <!-- App scripts -->
    <script src="scripts/jquery.jqprint-0.3.js"></script>
    <script src="scripts/homer.js"></script>
    <script src="scripts/zh.js"></script>
    <script>
      // 解决打印报错
      jQuery.browser = {};
      (function () {
        jQuery.browser.msie = false;
        jQuery.browser.version = 0;
        if (navigator.userAgent.match(/MSIE ([0-9]+)./)) {
          jQuery.browser.msie = true;
          jQuery.browser.version = RegExp.$1;
        }
      })();
    </script>
    <script>
      getUnitDetail();
      //生成左侧列表
      createList &&
        createList(function () {
          queryObj = query2obj(window.location.href);
        });

      var formData = [
        {
          label: "使用部位",
          key: "usedPart",
          value: "",
        },
        {
          label: "试件编号",
          key: "specimenNumber",
          value: "",
        },
        {
          label: "样品名称",
          key: "sampleName",
          value: "",
        },
        {
          label: "试件品种",
          key: "specimenType",
          value: "",
        },
        {
          label: "规格型号(牌号)",
          key: "modelName",
          value: "",
        },
        {
          label: "代表数量",
          key: "quantity",
          value: "",
          rules: ["isNumber"],
        },
        {
          label: "材料进厂时间",
          key: "entryTime",
          type: "date",
          value: moment().format("YYYY-MM-DD"),
        },
        {
          label: "出厂编号",
          key: "factoryNumber",
          value: "",
        },
        {
          label: "生产厂家",
          key: "factoryName",
          value: "",
        },
        {
          label: "取样组数",
          key: "samplingQuantity",
          value: "1组",
        },
        {
          label: "取样地点",
          key: "samplingAddress",
          value: "现场取样",
        },
        {
          label: "原试验编号",
          key: "oriTestNumber",
          value: "",
        },
      ];

      // var formData = {
      //   usedPart:	'string', //	Y	使用部位
      //   specimenNumber:	'string', // 	Y	试件编号
      //   sampleName:	'string', //	Y	样品名称
      //   specimenType:	'string', //	Y	试件品种
      //   modelName: 'string', //	Y	规格型号(牌号)
      //   quantity:	'string', //	Y	代表数量
      //   entryTime:	'string', //	Y	材料进厂时间
      //   factoryNumber:	'string', //	Y	出厂编号
      //   factoryName:	'string', //	Y	生产厂家
      //   quantity:	'string', //	Y	代表数量
      //   samplingQuantity:	'string', //	Y	取样组数
      //   samplingAddress: 'string', //	Y	取样地点
      //   testStatus:	'int',//	Y	检验状态(0：见证，1：复试)
      //   oriTestNumber: 'string', //	N	原试验编号(testStatus=1时，需要提交)
      // }
      var formStr = "";
      var rules = {};
      var messages = {};
      formData.forEach(function (item) {
        var dateType =
          item.type == "date" ? " data-date-format='yyyy-mm-dd'" : "";
        var value = item.value ? " value=" + item.value : "";
        // var isRequired = item.isRequired ? " required=" : "";
        var name = " name=" + item.key;
        var placeholder = " placeholder=请输入" + item.label;
        if (item.key == "usedPart" || item.key == "specimenType") {
          var placeholder = " placeholder=输入" + item.label + "，无用/代替";
        }

        formStr += [
          "<div class='p-n col-md-6 col-lg-4 is-reqiured " + item.key + "'>",
          "<label class='col-xs-4 control-label label-p7'>" +
            item.label +
            "</label>",
          "<div class='col-xs-8'>",
          "<input type='text' class='form-control' " +
            "id=" +
            item.key +
            dateType +
            name +
            // isRequired +
            value +
            placeholder +
            " />",
          "<div class='error-block error-block-" +
            item.key +
            " text-danger'></div>",
          "</div>",
          "</div>",
        ].join("");

        rules[item.key] = { required: true };
        var errTips = item.label + "不能为空";
        messages[item.key] = { required: errTips };
        if (item.rules) {
          $.each(item.rules, function (i, keyname) {
            rules[item.key][keyname] = true;
          });
        }
      });

      var radioStr =
        '<div class="col-md-6 col-lg-4" >\
          <label class="col-xs-4 control-label label-p7"></label>\
          <div class="col-xs-8" flex>\
            <label class="p-r-md"> <input type="radio" checked value="0" id="optionsRadios1" name="testStatus"> 见证 </label>\
            <label> <input type="radio"  value="1" id="optionsRadios2" name="testStatus"> 复试 </label>\
          </div>\
        </div>';
      $(".create-item").html(formStr);
      $(".create-item").append(radioStr);
      $(".oriTestNumber").hide(); // 初始化隐藏原试验编号
      function isShowOTN() {
        // 判断 见证和复试当前选中的状态，如果复试选中显示“原试验编号”
        $(':radio[name="testStatus"]:checked').val() == "1"
          ? $(".oriTestNumber").show()
          : $(".oriTestNumber").hide();
      }
      isShowOTN();
      $("input[type='radio'][name='testStatus']").change(function () {
        isShowOTN();
      });
      $("input[name='entryTime']").attr("readonly", "readonly");
      $("input[name='entryTime']").attr("placeholder", "请选择");
      $("input[name='entryTime']").datepicker({
        language: "zh-CN", //语言
        autoclose: true, //选择后自动关闭
        todayHighlight: true, //今天日期高亮
        setDate: moment().format("YYYY-MM-DD"),
      });

      // $("input[name='entryTime']").val(moment().format("YYYY-MM-DD"));
      // 提交校验
      $("#formData").validate({
        rules: rules,
        messages: messages,
        onfocusout: false,
        // focusCleanup: true, // 当未通过验证的元素获得焦点时,并移除错误提示 （避免和 focusInvalid.一起使用）
        submitHandler: function (form) {
          var formData = {};
          var t = $(form).serializeArray();
          for (var i = 0; i < t.length; i++) {
            formData[t[i].name] = t[i].value;
          }
          localStorage.setItem("form_style_query", JSON.stringify(formData));
          var queryObj = query2obj(window.location.href);
          queryObj.target_day = ymd();
          queryObj.type = "create";

          window.location.href =
            "./tables_design-z.html?" + obj2query(queryObj);
        },
        errorPlacement: function (error, element) {
          var name = $(element).attr("name");
          $(".error-block-" + name).html(error);
        },
        errorElement: "span",
      });

      // 返回列表
      $(".btn-back").click(function () {
        window.history.go(-1);
      });
      // 返回首页
      $(".query-other-form").click(function () {
        window.location.href = "./index-y.html";
      });

      // $('.reset-form').click(function() {
      //   $('#formData')[0].reset();
      // })
    </script>
  </body>
</html>
