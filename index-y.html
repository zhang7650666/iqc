<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Page title -->
    <title>质检</title>

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <!--<link rel="shortcut icon" type="image/ico" href="favicon.ico" />-->

    <!-- Vendor styles -->
    <link rel="stylesheet" href="vendor/fontawesome/css/font-awesome.css" />
    <link rel="stylesheet" href="vendor/metisMenu/dist/metisMenu.css" />
    <link rel="stylesheet" href="vendor/animate.css/animate.css" />
    <link rel="stylesheet" href="vendor/bootstrap/dist/css/bootstrap.css" />
    <link rel="stylesheet" href="vendor/sweetalert/lib/sweet-alert.css" />
    <link rel="stylesheet" href="vendor/toastr/build/toastr.min.css" />
    <!-- <link
      rel="stylesheet"
      href="vendor/datatables.net-bs/css/dataTables.bootstrap.min.css"
    /> -->

    <link
      rel="stylesheet"
      href="vendor/bootstrap-datepicker-master/dist/css/bootstrap-datepicker3.min.css"
    />
    <link
      rel="stylesheet"
      href="vendor/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css"
    />
    <link
      rel="stylesheet"
      href="vendor/clockpicker/dist/bootstrap-clockpicker.min.css"
    />
    <link
      rel="stylesheet"
      href="vendor/eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css"
    />

    <!-- App styles -->
    <link
      rel="stylesheet"
      href="fonts/pe-icon-7-stroke/css/pe-icon-7-stroke.css"
    />
    <link rel="stylesheet" href="fonts/pe-icon-7-stroke/css/helper.css" />
    <link rel="stylesheet" href="styles/style.css" />
    <link rel="stylesheet" href="styles/flex.css" />
  </head>
  <body class="fixed-navbar fixed-sidebar">
    <!--[if lt IE 7]>
      <p class="alert alert-danger">
        You are using an <strong>outdated</strong> browser. Please
        <a href="http://browsehappy.com/">upgrade your browser</a> to improve
        your experience.
      </p>
    <![endif]-->

    <!-- Header -->
    <div id="header" class="clear">
      <div class="color-line"></div>
      <!-- 常屏 项目名 -->
      <div id="logo" class="light-version">
        <span> 材料检验客户端 </span>
      </div>

      <!--  小屏 顶部导航 -->
      <nav role="navigation">
        <div class="header-link hide-menu"><i class="fa fa-bars"></i></div>
        <div class="small-logo">
          <span class="text-primary">材料检验客户端</span>
        </div>
        <div class="mobile-menu">
          <button
            type="button"
            class="navbar-toggle mobile-menu-toggle"
            data-toggle="collapse"
            data-target="#mobile-collapse"
          >
            <i class="fa fa-chevron-down"></i>
          </button>
          <div class="collapse mobile-navbar" id="mobile-collapse">
            <ul class="nav navbar-nav">
              <!-- <li>
                <a class="" href="login.html">Login</a>
              </li> -->
              <li>
                <a type="button" class="btn btn-text logoutBtn">Logout</a>
              </li>
            </ul>
          </div>
        </div>
        <!-- 常屏 顶部导航 -->
        <div class="navbar-right">
          <ul class="nav navbar-nav no-borders">
            <li class="dropdown">
              <a type="button" class="btn btn-text logoutBtn">
                <i class="pe-7s-upload pe-rotate-90"></i>
              </a>
            </li>
          </ul>
        </div>
      </nav>
    </div>

    <!-- Navigation -->
    <aside id="menu">
      <div id="navigation">
        <ul class="nav" id="side-menu"></ul>
      </div>
    </aside>

    <!-- Main Wrapper -->
    <div id="wrapper">
      <div class="content animate-panel">
        <!-- 新建分类见证表 -->
        <!-- <div class="hpanel">
          <div class="panel-body">
            <a  href="tables_design-z.html" class="btn btn-link">新建</a>
            <button id="createContract" type="button" class="btn btn-primary">
              新建
            </button>
          </div>
        </div> -->

        <!-- 见证记录 -->
        <div class="hpanel print-wp">
          <div class="panel-body">
            <div class="">
              <div class="col-md-6 col-lg-6 m-b">
                <span>工程编号:</span>
                <span>1111111111313123</span>
              </div>
              <div class="col-md-6 add-on">
                <span>工程编号:</span>
                <span>1111111111313123</span>
              </div>
            </div>
            <div class="pr-wp">
              <h3 class="pr-name txt-center">工程名称：工程名称工程名称工程名称工程名称工程名称</h3>
              <button id="createContract" type="button" class="btn btn-primary print-hide">
                新建
              </button>
            </div>
            <form class="form-inline print-hide">
                <div class="form-group" style="margin-bottom: 20px;">
                  <label >日期：</label>
                  <input id="WHC_PayDate" name="start" type="text" placeholder="选择开始日期" data-date-format="yyyy-mm-dd" class="form-control"/>
                  <span>~</span>
                  <input id="WHC_PayDate2" name="end" type="text" placeholder="选择结束日期" data-date-format="yyyy-mm-dd" class="form-control" />
                </div>
                <div class="form-group p-l-md" style="margin-bottom: 20px;">
                  <label for="class">分类选择：</label>
                  <select class="form-control" name="account" id="class">
                    <option value="">不限</option>
                    <option value="0" selected="true">未见证</option>
                    <option value="1">已见证</option>
                  </select>
                </div>
                <div class="form-group p-l-md" style="margin-bottom: 20px;">
                  <label for="status">报告类型：</label>
                  <select class="form-control" name="account" id="status">
                    <option value="">不限</option>
                    <option value="0" selected="true">未见证</option>
                    <option value="1">已见证</option>
                  </select>
                </div>
                <div class="form-group p-l-md" style="margin-bottom: 20px;">
                  <button type="button" class="btn btn-info" id="filterTableBtn">
                    筛选
                  </button>
                </div>
                <div class="form-group p-l-md" style="margin-bottom: 20px;">
                  <button type="button" class="btn btn-info print" >
                    打印列表
                  </button>
                </div>
              
            </form>
            <br />
            <div class="table-responsive">
              <table
                cellpadding="1"
                cellspacing="1"
                class="table table-bordered table-striped"
                id="print"
              >
                <thead>
                  <tr>
                    <th>ID</th>
                    <th width="200px">日期</th>
                    <th>项目编号</th>
                    <th>状态</th>
                    <!-- <th>见证记录</th> -->
                    <th>备注</th>
                    <th>操作</th>
                  </tr>
                </thead>
                <tbody id="tableBody">
                  <tr class="txt-center">
                    <td colspan="6">--没有数据--</td>
                  </tr>
                </tbody>
                <tfoot id="tableFoot" class="hidden">
                  <tr>
                    <td colspan="6">
                      <nav aria-label="Page navigation">
                        <ul
                          class="pagination pull-right"
                          id="paginationBox"
                        ></ul>
                      </nav>
                    </td>
                  </tr>
                </tfoot>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    <style>
      .pr-wp{
        position: relative;
        text-align: center;
        margin-bottom: 20px;
      }
      .pr-name{
        display: inline-block;
        line-height: 30px;
        color: #000;
        padding: 0px 15px;
        font-size: 20px;
        border-bottom: 2px solid #000;
      }
      
      #createContract{
        position: absolute;
        top: 8px;
        right: 0px;
      }
    </style>
    <!-- Vendor scripts -->
    <script src="vendor/jquery/dist/jquery.min.js"></script>
    <script src="vendor/jquery-ui/jquery-ui.min.js"></script>
    <script src="vendor/slimScroll/jquery.slimscroll.min.js"></script>
    <script src="vendor/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="vendor/jquery-flot/jquery.flot.js"></script>
    <script src="vendor/jquery-flot/jquery.flot.resize.js"></script>
    <script src="vendor/jquery-flot/jquery.flot.pie.js"></script>
    <script src="vendor/flot.curvedlines/curvedLines.js"></script>
    <script src="vendor/jquery.flot.spline/index.js"></script>
    <script src="vendor/metisMenu/dist/metisMenu.min.js"></script>
    <script src="vendor/iCheck/icheck.min.js"></script>
    <script src="vendor/peity/jquery.peity.min.js"></script>
    <script src="vendor/sparkline/index.js"></script>
    <script src="vendor/sweetalert/lib/sweet-alert.min.js"></script>
    <script src="vendor/toastr/build/toastr.min.js"></script>
    <script src="vendor/moment/moment.js"></script>
    <script src="vendor/bootstrap-datepicker-master/dist/js/bootstrap-datepicker.min.js"></script>
    <script src="vendor/clockpicker/dist/bootstrap-clockpicker.min.js"></script>
    <script src="vendor/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
    <!-- App scripts -->
    <script src="scripts/jquery.jqprint-0.3.js"></script>
    <script src="scripts/homer.js"></script>
    <script>
      // 解决打印报错
      jQuery.browser = {};
      (function () {
        jQuery.browser.msie = false;
        jQuery.browser.version = 0;
        if (navigator.userAgent.match(/MSIE ([0-9]+)./)) {
          jQuery.browser.msie = true;
          jQuery.browser.version = RegExp.$1;
        }
      })();
    </script>
    <script>
      var queryObj = {};
      //生成左侧列表
      createList &&
        createList(function () {
          queryObj = query2obj(window.location.href);
          getList();
        });
      //初始化日期
      $('#WHC_PayDate').datepicker({
        language: 'zh-CN', //语言
        // todayBtn : "linked",//显示今天按钮
        autoclose : true,//选择后自动关闭
        todayHighlight : true,//今天日期高亮
        clearBtn: true//清除按钮
        // endDate : new Date() //设置结束时间
    }).on('changeDate',function(e){
        var startTime = e.date;
        $('#WHC_PayDate2').datepicker('setStartDate',startTime);
        
    });
    //日期选择器 选择结束日期
    $('#WHC_PayDate2').datepicker({
        language: 'zh-CN', //语言
        // todayBtn : "linked",//显示今天按钮
        autoclose : true,//选择后自动关闭
        clearBtn: true,//清除按钮
        todayHighlight : true//今天日期高亮
        // endDate : new Date() //设置结束时间
    }).on('changeDate',function(e){
        var endTime = e.date;
        $('#WHC_PayDate').datepicker('setEndDate',endTime);
        
    });
      $("#createContract").click(function () {
        window.location.href = "./tables_design-z.html?form_id=" + queryObj.id;
      });
      //生成分页元素
      function getPaginatLi(pagesCount) {
        if (pagesCount == 0 || pagesCount == "" || pagesCount === undefined) {
          return "";
        }
        var num = "";
        for (var i = 1; i < pagesCount; i++) {
          num +=
            '<li><a href="#" data-page="' + pagesCount + '">' + i + "</a></li>";
        }

        var paginationEle = [
          '<li><a href="#" aria-label="Previous"><span aria-hidden="true">&laquo;</span> </a>',
          num,
          '<li><a href="#" aria-label="Next"><span aria-hidden="true">&raquo;</span> </a></li>',
        ];

        $("#paginationBox").html(paginationEle.join(""));
        $("#tableFoot").removeClass("hidden");
      }

      // 创建表格
      function createTr(data) {
        if (!Array.isArray(data)) {
          // console.error("数据异常");
          return "";
        }

        var trs = "";
        // 没有数据时，插入空数据占位
        !data.length &&
          (trs =
            '<tr class="txt-center"><td colspan="6">--没有数据--</td></tr>');
        var target_start_day =  $('#WHC_PayDate').val(); // 开始日期
        var target_end_day = $('#WHC_PayDate2').val(); // 结束日期
        $(data).each(function (idx, item) {
          var isWitness = item.status == 1;
          var readDetail =
            " <a href='tables_design-z.html?id=" +
            item.id +
            "&target_start_day=" +
            target_start_day +
            "&target_end_day=" +
            target_end_day +
            "&type=contract'> " +
            "合同详情</a>";
          var witnessDetail =
            " <a href='tables_design-z.html?id=" +
            item.id +
            "&target_start_day=" +
            target_start_day +
            "&target_end_day=" +
            target_end_day +
            "&type=witness'> " +
            "见证详情</a>";

          var cancleDetail =
            '<button type="button" class="btn btn-info cancleWitness" data-id="' +
            item.id +
            '">取消见证</button>';

          trs +=
            "<tr> <td> " +
            item.id +
            "</td> <td> " +
            item.update_at +
            "</td><td> " +
            item.project_id +
            "</td><td> " +
            (isWitness ? "已见证" : "非见证") +
            "</td><td>-</td><td class='td-set'>" +
            readDetail +
            (isWitness ? witnessDetail : "") +
            (item.witness_record_id == 1 ? cancleDetail : "") +
            "</td>" +
            "</tr>";
        });
        // $(".emptyTr").addClass("hidden");

        $("#tableBody").html(trs);

        $(".cancleWitness").on("click", function () {
          var id = $(this).attr("data-id");
          // cancelWitness/
          $.ajax({
            url: "http://meterial.cxhy.cn/cancelWitness/",
            type: "POST",
            dataType: "json",
            contentType: "application/json",
            data: JSON.stringify({
              id: id,
              target_start_day: target_start_day,
              target_end_day: target_end_day
            }),
            success: function (res) {
              if (res.code == 200) {
                toastr && toastr.success("取消见证记录成功！");
                getList();
              }
            },
            error: function (error) {},
          });
        });
      }

      //获取表格数据
      function getList() {
        var status = $("#status").val() || 0;
        var target_start_day =  $('#WHC_PayDate').val(); // 开始日期
        var target_end_day = $('#WHC_PayDate2').val(); // 结束日期
        $.get(
          "http://meterial.cxhy.cn/getRecordList/",
          {
            status: status,
            target_start_day: target_start_day,
            target_end_day: target_end_day,
            form_id: queryObj.id,
          },
          function (res) {
            var data = res.data;
            var total = data.total || 0;
            var pagesCount = parseInt(total) / 20;
            getPaginatLi(pagesCount);
            createTr(data);
          }
        );
      }

      // getList();

      $("#filterTableBtn").on("click", function () {
        getList();
      });

      // 点击打印
      $(".print").click(function () {
        $(".print-hide").hide();
        $(".print-wp").jqprint();
        $(".print-hide").show();
      });
    </script>
  </body>
</html>
