<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Page title -->
    <title>质检</title>

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <!--<link rel="shortcut icon" type="image/ico" href="favicon.ico" />-->

    <!-- Vendor styles -->
    <link rel="stylesheet" href="vendor/fontawesome/css/font-awesome.css" />
    <link rel="stylesheet" href="vendor/metisMenu/dist/metisMenu.css" />
    <link rel="stylesheet" href="vendor/animate.css/animate.css" />
    <link rel="stylesheet" href="vendor/bootstrap/dist/css/bootstrap.css" />
    <link rel="stylesheet" href="vendor/sweetalert/lib/sweet-alert.css" />
    <link rel="stylesheet" href="vendor/toastr/build/toastr.min.css" />
    <!-- <link
      rel="stylesheet"
      href="vendor/datatables.net-bs/css/dataTables.bootstrap.min.css"
    /> -->

    <link
      rel="stylesheet"
      href="vendor/bootstrap-datepicker-master/dist/css/bootstrap-datepicker3.min.css"
    />
    <link
      rel="stylesheet"
      href="vendor/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css"
    />
    <link
      rel="stylesheet"
      href="vendor/clockpicker/dist/bootstrap-clockpicker.min.css"
    />
    <link
      rel="stylesheet"
      href="vendor/eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css"
    />

    <!-- App styles -->
    <link
      rel="stylesheet"
      href="fonts/pe-icon-7-stroke/css/pe-icon-7-stroke.css"
    />
    <link rel="stylesheet" href="fonts/pe-icon-7-stroke/css/helper.css" />
    <link rel="stylesheet" href="styles/style.css" />
    <link rel="stylesheet" href="styles/flex.css" />
  </head>
  <body class="fixed-navbar fixed-sidebar">
    <!--[if lt IE 7]>
      <p class="alert alert-danger">
        You are using an <strong>outdated</strong> browser. Please
        <a href="http://browsehappy.com/">upgrade your browser</a> to improve
        your experience.
      </p>
    <![endif]-->

    <!-- Header -->
    <div id="header" class="clear">
      <div class="color-line"></div>
      <!-- 常屏 项目名 -->
      <div id="logo" class="light-version">
        <span> 材料检验客户端 </span>
      </div>

      <!--  小屏 顶部导航 -->
      <nav role="navigation">
        <div class="header-link hide-menu"><i class="fa fa-bars"></i></div>
        <div class="small-logo">
          <span class="text-primary">材料检验客户端</span>
        </div>
        <div class="mobile-menu">
          <button
            type="button"
            class="navbar-toggle mobile-menu-toggle"
            data-toggle="collapse"
            data-target="#mobile-collapse"
          >
            <i class="fa fa-chevron-down"></i>
          </button>
          <div class="collapse mobile-navbar" id="mobile-collapse">
            <ul class="nav navbar-nav">
              <li>
                <a type="button" class="btn btn-text logoutBtn">Logout</a>
              </li>
            </ul>
          </div>
        </div>
        <!-- 面包线 -->
        <div id="hbreadcrumb">
          <ol class="hbreadcrumb breadcrumb">
            <li class="active">
              <span>首页</span>
            </li>
          </ol>
        </div>
        <!-- 常屏 顶部导航 -->
        <div class="navbar-right">
          <ul class="nav navbar-nav no-borders">
            <li class="dropdown">
              <a type="button" class="btn btn-text logoutBtn">
                <i class="pe-7s-upload pe-rotate-90"></i>
              </a>
            </li>
          </ul>
        </div>
      </nav>
    </div>

    <!-- Navigation -->
    <aside id="menu" class="home-menu">
      <div id="navigation">
        <ul class="nav" id="side-menu">
          <li class="active">
            <a href="index-y.html" class="hight">
              <svg
                t="1623659483158"
                class="icon ver-a-m"
                viewBox="0 0 1024 1024"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                p-id="14226"
                width="16"
                height="16"
              >
                <path
                  d="M512.546 86.050c0 0-12.561-0.546-24.030 7.1-12.015 8.192-462.029 380.109-462.029 380.109s-32.768 25.668 2.731 70.997 74.82 3.823 74.82 3.823l407.962-359.356 414.515 364.817c0 0 36.591 30.583 70.451-11.469 33.86-42.598-3.277-72.090-3.277-72.090l-121.242-99.942v-175.309h-164.932v39.868l-168.209-139.81c0 0-10.923-9.83-26.761-8.738z"
                  p-id="14227"
                  fill="#ffffff"
                ></path>
                <path
                  d="M512.546 241.152l-410.146 357.171v300.919l333.141 0.546v-246.306l152.917 1.638v244.122l333.141 0.546v-300.919z"
                  p-id="14228"
                  fill="#ffffff"
                ></path>
              </svg>
              <span class="nav-label">首页</span>
              <!-- <span class="label label-success pull-right">v.1</span> -->
            </a>
          </li>
          <li>
            <a href="create_form-z.html">
              <svg
                t="1623659338793"
                class="icon ver-a-m"
                viewBox="0 0 1092 1024"
                version="1.1"
                xmlns="http://www.w3.org/2000/svg"
                p-id="13302"
                width="16"
                height="16"
              >
                <path
                  d="M184.04486 3.417511l396.910135 0c0.118705 43.924897-0.189529 87.849794 0.160601 131.775689 1.715738 46.251119 23.998392 95.783089 68.003091 115.790394 14.768318 6.605593 31.18155 7.833543 47.156869 7.643016 46.95936 0.01995 93.907747-0.079802 140.865112 0.049876 0.079802 84.317568 0.069827 168.646108 0 252.973651-45.971813-4.679377-93.307239-0.629437-136.745345 15.766838-57.874249 21.463687-108.434665 62.025937-141.87261 113.934005-99.444994 0.189529-198.889987-0.049876-298.333983 0.118705-20.026258-0.149628-39.105867 10.546803-50.790843 26.562024-12.97178 17.052644-15.55636 40.862504-8.052998 60.740131 9.328829 23.449754 33.477846 40.431574 58.902695 40.152268 84.436273 0.129678 168.874541 0.01995 253.311811 0.049876-5.937253 67.555203 10.656531 137.28301 49.97088 192.923806-120.059789 0.01995-240.121574 0.01995-360.191339 0-16.194775 0.199504-31.920714-4.948708-46.239149-12.183737-28.62889-14.589761-53.464203-36.899348-70.428067-64.240436-10.915887-16.835184-17.293047-36.690865-17.063617-56.836826-0.038903-228.834609 0.010973-457.670216-0.01995-686.515798-1.416482-38.805613 18.130965-75.766807 45.19175-102.528335 18.927986-18.310519 42.407666-33.716254 69.259969-36.170159M250.610521 387.07656c-21.584388 3.203044-40.662002 18.648679-49.004281 38.70586-8.131802 20.68562-5.078386 45.781286 9.140297 63.133187 11.913409 15.396757 30.893266 25.176465 50.491586 24.867234 128.031988 0.038903 256.076943 0.079802 384.119904-0.01995 30.464331 0.310229 58.533611-24.536056 62.522703-54.601378 6.954726-36.542235-24.646781-73.192202-61.517201-72.870999-126.387073-0.179554-252.774147-0.01995-379.160223-0.079802-5.549217-0.010973-11.116389-0.010973-16.593784 0.868842L250.610521 387.07656zM645.337079 3.417511l10.147794 0c26.792452 4.789105 46.798759 25.016862 67.263926 41.37124 35.523764 30.803489 72.742319 60.659331 101.311358 98.336746 11.274995 14.169804 14.818194 32.379574 13.081507 50.102553-50.271134 0.109727-100.542268 0.079802-150.804424 0.010973-8.450011 0.189529-16.144898-4.539724-21.123532-11.125366-12.384239-14.678541-18.828233-33.936706-19.827751-52.954469-0.118705-41.91888-0.01995-83.827784-0.049876-125.737686L645.337079 3.417511zM783.938814 575.939453c7.264955-0.507739 14.838144-0.219455 21.922548-0.847894 23.568459 0.538662 47.338418 3.650932 69.630049 11.53435 54.621329 16.41423 100.902374 56.647297 127.724751 106.680023 28.029379 53.784408 34.326738 118.991443 14.818194 176.647235-18.529974 61.04637-66.186602 112.077616-124.91074 136.474019-55.598901 23.349005-120.439845 23.489655-176.169422 0.069827-49.8821-20.396339-91.532647-60.2693-114.591372-108.944398-24.546031-52.367926-29.146604-114.213311-10.328346-169.103971 21.293111-69.259969 80.047175-124.889792 149.487695-144.479135 11.355794-2.944686 23.029797-5.299836 34.496316-7.125302 2.604531-0.389034 5.549217 0.199504 7.922322-0.908743M771.892734 669.027237c-0.729189 32.748657 0.408984 65.578114-0.56759 98.306821-24.517103 0.199504-49.871128-0.678315-73.870517 0.868842-2.974612-1.307752-6.196609 0.288284-9.309876-0.45886-12.593719-0.310229-27.878753-0.099752-36.390611 11.395695-16.623709 17.052644-4.639476 48.566368 18.430222 51.847219 10.427101 0.827944 20.91505-0.118705 31.242399 0.749139 2.174599-1.436432 5.468417 1.118223 7.663964-0.288284 20.834251 0.997522 41.769251 0.389034 62.653378 0.649387-0.079802 31.771085-0.069827 63.542171-0.030923 95.303281-0.310229 16.863115 15.176304 32.718732 32.259871 31.570583 16.205747 0.379058 31.031921-14.318435 31.093768-30.574059 0.389034-32.349648 0.619461-64.708274 0.938668-97.059918 33.924736-0.31821 67.883388 0.497764 101.788173-0.417962 13.940374-3.452425 25.464749-16.494031 25.036812-31.223446 0.468835-13.252084-8.950768-25.356019-20.993854-30.045372-9.419603-2.804035-19.408791-1.236928-29.036877-1.607008-25.584452-0.030923-51.178879-0.069827-76.774304 0.030923-0.368086-32.359624-0.507739-64.720245-0.957621-97.078871 0.069827-14.039129-10.884963-26.222866-23.848763-30.243879-18.200792-4.260418-38.068444 9.419603-39.324324 28.279757L771.892734 669.027237z"
                  p-id="13303"
                  fill="#ffffff"
                ></path>
              </svg>
              <span class="nav-label">新建表单</span>
              <!-- <span class="label label-warning pull-right">NEW</span> -->
            </a>
          </li>
        </ul>
      </div>
    </aside>

    <!-- Main Wrapper -->
    <div id="wrapper">
      <div class="content animate-panel">
        <div class="hpanel">
          <div class="panel-body">
            <!-- <h2 class="font-light m-b-xs">Colors and Buttons</h2> -->
            <!-- <small>The basic color palette</small> -->
            <ul id="unit-info-box" class="l-s-n line34"></ul>
          </div>
        </div>

        <!-- 见证记录 -->
        <div class="hpanel print-wp">
          <div class="panel-body">
            <div class="p-m">
              <button
                id="createContract"
                type="button"
                class="btn btn-primary print-hide pull-right"
              >
                新建
              </button>
            </div>
            <div class="pr-wp por txt-center p-b-lg">
              <h3 class="pr-name txt-center" id="project-title">
                工程名称：工程名称工程名称工程名称工程名称工程名称
              </h3>
            </div>
            <!-- 筛选 -->
            <form class="form-inline print-hide">
              <div class="form-group" style="margin-bottom: 15px !important">
                <label>日期：</label>
                <input
                  id="WHC_PayDate"
                  type="text"
                  placeholder="选择开始日期"
                  data-date-format="yyyy-mm"
                  class="form-control"
                />
              </div>
              <div
                class="form-group p-l-md"
                style="margin-bottom: 15px !important"
              >
                <label for="classify">分类选择：</label>
                <select class="form-control" name="account" id="classify">
                  <option value="">不限</option>
                  <option value="0" selected="true">未见证</option>
                  <option value="1">已见证</option>
                </select>
              </div>
              <div
                class="form-group p-l-md"
                style="margin-bottom: 15px !important"
              >
                <label for="status">报告类型：</label>
                <select class="form-control" name="account" id="status">
                  <option value="" selected="true">全部</option>
                  <option value="0">未见证</option>
                  <option value="1">已见证</option>
                </select>
              </div>
              <div
                class="form-group p-l-md fillter-btn"
                style="margin-bottom: 15px !important"
              >
                <button type="button" class="btn btn-info" id="filterTableBtn">
                  筛选
                </button>
              </div>
              <div
                class="form-group p-l-md"
                style="margin-bottom: 15px !important"
              >
                <button type="button" class="btn btn-info print">
                  打印列表
                </button>
              </div>
            </form>
            <br />
            <div class="table-responsive">
              <table
                cellpadding="1"
                cellspacing="1"
                class="table table-bordered table-striped"
                id="print"
              >
                <thead>
                  <tr>
                    <th>日期</th>
                    <th>试件编号</th>
                    <th>试件名称</th>
                    <th>委托人</th>
                    <th>见证人</th>
                    <th>检验机构</th>
                    <th>状态</th>
                    <th>检测表单</th>
                    <th>见证报告</th>
                  </tr>
                </thead>
                <tbody id="tableBody"></tbody>
              </table>
            </div>
            <tfoot id="tableFoot" class="hidden">
              <tr>
                <td colspan="6">
                  <nav
                    aria-label="Page navigation"
                    style="position: relative; padding-bottom: 15px"
                  >
                    <div
                      class="total"
                      style="position: absolute; left: 0px; top: 5px"
                    >
                      总共 <span style="color: #3498db"></span> 数据
                    </div>
                    <ul
                      class="pagination pull-right"
                      id="paginationBox"
                      style="margin: 0px"
                    ></ul>
                  </nav>
                </td>
              </tr>
            </tfoot>
          </div>
        </div>
      </div>
    </div>
    <!-- Vendor scripts -->
    <script src="vendor/jquery/dist/jquery.min.js"></script>
    <script src="vendor/jquery-ui/jquery-ui.min.js"></script>
    <script src="vendor/slimScroll/jquery.slimscroll.min.js"></script>
    <script src="vendor/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="vendor/jquery-flot/jquery.flot.js"></script>
    <script src="vendor/jquery-flot/jquery.flot.resize.js"></script>
    <script src="vendor/jquery-flot/jquery.flot.pie.js"></script>
    <script src="vendor/flot.curvedlines/curvedLines.js"></script>
    <script src="vendor/jquery.flot.spline/index.js"></script>
    <script src="vendor/metisMenu/dist/metisMenu.min.js"></script>
    <script src="vendor/iCheck/icheck.min.js"></script>
    <script src="vendor/peity/jquery.peity.min.js"></script>
    <script src="vendor/sparkline/index.js"></script>
    <script src="vendor/sweetalert/lib/sweet-alert.min.js"></script>
    <script src="vendor/toastr/build/toastr.min.js"></script>
    <script src="vendor/moment/moment.js"></script>
    <script src="vendor/bootstrap-datepicker-master/dist/js/bootstrap-datepicker.min.js"></script>
    <script src="vendor/clockpicker/dist/bootstrap-clockpicker.min.js"></script>
    <script src="vendor/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
    <script src="vendor/datatables/media/js/jquery.dataTables.min.js"></script>
    <script src="vendor/datatables.net-bs/js/dataTables.bootstrap.min.js"></script>
    <!-- App scripts -->
    <script src="scripts/jquery.jqprint-0.3.js"></script>
    <script src="scripts/homer.js"></script>
    <script src="scripts/zh.js"></script>
    <script>
      // 解决打印报错
      jQuery.browser = {};
      (function () {
        jQuery.browser.msie = false;
        jQuery.browser.version = 0;
        if (navigator.userAgent.match(/MSIE ([0-9]+)./)) {
          jQuery.browser.msie = true;
          jQuery.browser.version = RegExp.$1;
        }
      })();
    </script>
    <script>
      var opt_classify_id = ""; //分类id
      var pageIndex = 1;
      var queryObj = query2obj(window.location.href);
      // 获取分类数据
      $.get("http://meterial.cxhy.cn/getClassifyList/", function (res) {
        if (res.code == 200) {
          // 默认传第一个分类id
          opt_classify_id = "";
          // 获取表格数据
          getList();
          res.data.unshift({ classify_name: "全部", id: "" });
          createOptions("classify", res.data);
        }
      });
      function createOptions(idEle, optList) {
        var optStr = "";
        optList.forEach(function (item) {
          optStr +=
            '<option value="' +
            item.id +
            '">' +
            item.classify_name +
            "</option>";
        });
        $("#" + idEle).html(optStr);
      }
      // 下拉选择选中事件

      $("#classify").change(function () {
        opt_classify_id = $(this).val();
      });
      getUnitDetail();
      // var userInfo = getUserInfo();
      // 设置默认时间
      var sevenAgo = moment().subtract(7, "days").format("YYYY-MM");

      //初始化日期
      $("#WHC_PayDate").datepicker({
        language: "zh-CN", //语言
        autoclose: true, //选择后自动关闭
        // todayHighlight: true, //今天日期高亮
        startView: "months",
        maxViewMode: "years",
        minViewMode: "months",
        minView: 3,
      });
      $("#WHC_PayDate").val(sevenAgo);

      $("#createContract").click(function () {
        window.location.href = "./create_form-z.html";
      });
      //生成分页元素
      function getPaginatLi(pagesCount) {
        console.log(666, pagesCount);
        if (
          pagesCount == 0 ||
          pagesCount == 1 ||
          pagesCount == "" ||
          pagesCount === undefined
        ) {
          return "";
        }
        var num = "";
        for (var i = 1; i <= pagesCount; i++) {
          num +=
            '<li class="' +
            (i == 1 ? "active" : "") +
            ' page"><a href="javascript:;" data-page="' +
            pagesCount +
            '">' +
            i +
            "</a></li>";
        }

        var paginationEle = [
          '<li class="page-pre"><a href="javascript:;" aria-label="Previous"><span aria-hidden="true">&laquo;</span> </a>',
          num,
          '<li class="page-next"><a href="javascript:;" aria-label="Next"><span aria-hidden="true">&raquo;</span> </a></li>',
        ];

        $("#paginationBox").html(paginationEle.join(""));
        $("#tableFoot").removeClass("hidden");
        // 切换
        $("#paginationBox .page").click(function () {
          $(this).siblings().removeClass("active");
          $(this).addClass("active");
          var pageIndex = parseInt($("#paginationBox .page.active a").html());
          getList();
        });
        // 下一页
        $(".page-next").click(function () {
          var pageIndex = parseInt($("#paginationBox .page.active a").html());
          if (pagesCount >= pageIndex + 1) {
            $("#paginationBox .page.active").next().addClass("active");
            $("#paginationBox .page")
              .eq(pageIndex - 1)
              .removeClass("active");
            getList();
          }
        });
        // 上一页
        $(".page-pre").click(function () {
          var pageIndex = parseInt($("#paginationBox .page.active a").html());
          if (pageIndex - 1 > 0) {
            $("#paginationBox .page.active").prev().addClass("active");
            $("#paginationBox .page")
              .eq(pageIndex - 1)
              .removeClass("active");
            getList();
          }
        });
      }
      // 创建表格
      function createTr(data) {
        if (!Array.isArray(data)) {
          // console.error("数据异常");
          return "";
        }

        var trs = [];
        // 没有数据时，插入空数据占位
        !data.length &&
          trs.push(
            '<tr class="txt-center"><td colspan="9">--没有数据--</td></tr>'
          );
        $(data).each(function (idx, item) {
          var target_day = item.create_at.split(" ")[0];
          var isWitness = item.status == 1;
          var witnessDetail =
            " <a style='color:#3498db' href='tables_design-z.html?id=" +
            item.id +
            "&target_day=" +
            target_day +
            "&type=witness'> " +
            "见证详情</a>";
          var cancleDetail =
            '<button type="button" class="btn btn-info cancleWitness" data-id="' +
            item.id +
            '" data-target_day="' +
            target_day +
            '">取消见证</button>';

          var edit =
            " <a style='color:#3498db' href='tables_design-z.html?id=" +
            item.id +
            "&target_day=" +
            target_day +
            "&type=" +
            (isWitness ? "view" : "edit") +
            "'> " +
            (isWitness ? "查看" : "编辑") +
            "</a>";
          trs.push(
            "<tr> " +
              [
                "<td> " + item.create_at + "</td> ",
                "<td> " + item.project_id + "</td>",
                "<td> " + item.classifyName + "</td>",
                "<td> " + item.entrustName + "</td>",
                "<td> " + item.witnessName + "</td>",
                "<td> " + item.witness_group + "</td>",
                "<td> " + (isWitness ? "已见证" : "非见证") + "</td>",
                "<td>" + edit + "</td>",
                "<td class='td-set'>" +
                  (isWitness ? witnessDetail : "") +
                  (item.witness_record_id == 1 ? cancleDetail : "") +
                  "</td>",
              ].join("") +
              "</tr> "
          );
        });

        $("#tableBody").html(trs.join(""));
      }

      //获取表格数据
      function getList() {
        var status = $("#status").val() || "";
        $.get(
          "http://meterial.cxhy.cn/getRecordList/",
          {
            status: status,
            target_month: $("#WHC_PayDate").val(), // 开始日期
            classifyId: opt_classify_id,
            page: pageIndex,
          },
          function (res) {
            var data = res.data;
            var total = data.length || 0;
            $(".total span").html(total);
            var pagesCount = parseInt(total) / 20;

            if (!$("#paginationBox").html()) {
              getPaginatLi(Math.ceil(pagesCount));
            }
            createTr(data);
          }
        );
      }
      // 取消见证
      $("document").on("click", "cancleWitness", function () {
        var id = $(this).attr("data-id");
        // cancelWitness/
        $.ajax({
          url: "http://meterial.cxhy.cn/cancelWitness/",
          type: "POST",
          dataType: "json",
          contentType: "application/json",
          data: JSON.stringify({
            id: id,
            target_day: $(this).attr("data-target_day"), // 开始日期
          }),
          success: function (res) {
            if (res.code == 200) {
              toastr && toastr.success("取消见证记录成功！");
              getList();
            }
          },
          error: function (error) {},
        });
      });

      $("#filterTableBtn").on("click", function () {
        getList();
      });

      // 点击打印
      $(".print").click(function () {
        $(".print-hide").hide();
        $("#tableFoot").hide();
        $(".print-wp").jqprint();
        $(".print-hide").show();
        $("#tableFoot").show();
      });
    </script>
  </body>
</html>
