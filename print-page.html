<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Page title -->
    <title>打印</title>

    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <!--<link rel="shortcut icon" type="image/ico" href="favicon.ico" />-->

    <!-- Vendor styles -->
    <link rel="stylesheet" href="vendor/fontawesome/css/font-awesome.css" />
    <link rel="stylesheet" href="vendor/metisMenu/dist/metisMenu.css" />
    <link rel="stylesheet" href="vendor/animate.css/animate.css" />
    <link rel="stylesheet" href="vendor/bootstrap/dist/css/bootstrap.css" />
    <link rel="stylesheet" href="vendor/toastr/build/toastr.min.css" />
    <link rel="stylesheet" href="vendor/sweetalert/lib/sweet-alert.css" />
    <link
      rel="stylesheet"
      href="vendor/bootstrap-datepicker-master/dist/css/bootstrap-datepicker3.min.css"
    />
    <link
      rel="stylesheet"
      href="vendor/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css"
    />
    <link
      rel="stylesheet"
      href="vendor/clockpicker/dist/bootstrap-clockpicker.min.css"
    />
    <link
      rel="stylesheet"
      href="vendor/eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css"
    />

    <!-- App styles -->
    <link rel="stylesheet" href="fonts/pe-icon-7-stroke/css/helper.css" />
    <link rel="stylesheet" href="styles/style.css" />
    <link rel="stylesheet" href="styles/flex.css" />
    <style>
      .fixed-navbar #wrapper {
        top: 0px;
      }
    </style>
  </head>

  <body class="fixed-navbar">
    <!--[if lt IE 7]>
      <p class="alert alert-danger">
        You are using an <strong>outdated</strong> browser. Please
        <a href="http://browsehappy.com/">upgrade your browser</a> to improve
        your experience.
      </p>
    <![endif]-->

    <!-- Main Wrapper -->
    <div id="wrapper" class="m-n">
      <div class="content animate-panel content-width">
        <div class="hpanel">
          <div id="mainWrapper" class="ovh">
            <div id="contractTable">
              <div class="panel-body" style="padding: 0">
                <form
                  action="#"
                  id="loginForm1"
                  class="form-horizontal label-right"
                >
                  <div class="table-donwload-section">
                    <!-- 工程编号 -->
                    <div class="row">
                      <!-- <div
                        class="col-lg-12 table-order"
                        style="font-size: 12px; text-align: left"
                      ></div> -->
                    </div>
                    <div flex>
                      <!-- title -->
                      <div flex-box="1">
                        <h3
                          class="table-title txt-center"
                          style="
                            text-align: center;
                            height: 30px;
                            line-height: 30px;
                            font-size: 18px;
                          "
                        ></h3>
                      </div>
                      <div
                        class="qr-code code-pos hidden"
                        style="text-align: right"
                      >
                        <img
                          src=""
                          alt=""
                          class="contract-code"
                          width="80px"
                          height="80px"
                        />
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
            <!-- class="col-xs-12 col-md-12 col-lg-12 hidden" -->
            <div id="witnessTable">
              <div class="panel-body" style="padding: 0">
                <form
                  action="#"
                  id="loginForm2"
                  class="form-horizontal label-right"
                >
                  <div class="table-donwload-section">
                    <!-- 工程编号 -->
                    <div class="row">
                      <!-- <div
                        class="col-lg-12 table-order"
                        style="font-size: 12px; text-align: left"
                      ></div> -->
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
        <!-- 模版 -->
        <script type="text/template" id="tableTemp">
          <div class="no-border" style="text-align: center">
            <style type="text/css">
            .table-header {width: 100%}
              .table-header tr th {
                border: 1px solid #fff;
                text-align: left;
                /* width: 12.5%; */
                font-size: 13.2px;
              }
              .font-weight {
                  /* font-weight: 600; */
              }
              .label-text {
                font-family:'Microsoft Yahei', SimHei;
              }
              .no-border {
                  border: 0;
              }
              .table-body {
                width: 100%;
                border: 1px solid #000;
                border-bottom: 0;
                border-collapse: collapse;
              }

              .table-body tr td,
              .table-body tr th {
                  /* width: 16%; */
                  border-right: 1px solid #000;
                  border-bottom: 1px solid #000;
                  font-size: 12px;
                  height:25px;
                  font-family: NSimSun,SimSun;
                  box-sizing: border-box;
                  word-break:break-all;
                  word-wrap:break-word;
                  border-collapse:collapse;
              }
              .table-body tr{
                height: 25px;
              }
              .td-label {
                min-width: 40px;
              }
              label {
                margin-bottom: 0 !important;
              }

              #witnessTable .table-body tr td,
              #witnessTable .table-body tr th,
              #witnessTable  .table-body tr {
                height: 44px;
                font-size: 13.2px;
              }

              .table-header {
                border: 1px solid #fff;
              }

              .p-xs {
                padding: 0 5px
              }
              .table-desc {
                font-size: 12px;
                word-wrap: break-word;
                margin-top: 10px;
                text-align: left;
              }

              .checkbox-wp {
                text-align: left;
                margin-left: 10px;
              }

              .txt-center {
                  text-align: center;
              }
              .txt-left {
                  text-align: left;
              }
              .txt-right {
                  text-align: right;
              }
              textarea {
                width:100%;
                border: 0px;
                outline: none;
                margin: 0px;
              }

              [flex] {
                display: -webkit-box;
                display: -webkit-flex;
                display: -ms-flexbox;
                display: flex;
              }

              [flex-box="0"] {
                -webkit-box-flex: 0;
                -webkit-flex-grow: 0;
                -ms-flex-positive: 0;
                flex-grow: 0;
                -webkit-flex-shrink: 0;
                -ms-flex-negative: 0;
                flex-shrink: 0;
              }

              [flex-box="1"] {
                -webkit-box-flex: 1;
                -webkit-flex-grow: 1;
                -ms-flex-positive: 1;
                flex-grow: 1;
                -webkit-flex-shrink: 1;
                -ms-flex-negative: 1;
                flex-shrink: 1;
              }
              .table-win tr:first-child {
                height: 80px !important;
              }
              .table-win tr th,
              .table-win tr td {
                  /* height: 23px;
                  line-height:23px; */
                  font-size: 14px;
                  /* font-family:"SimHei"; */
                  text-align:center;
              }
              .table-win tr td .jz-str1{
                  /* border-bottom:1px solid #000; */
                  font-size: 22.5px;
                  font-family:"SimHei";
                  /* font-weight: 500; */
              }
              .table-win tr td .jz-str2{
                  font-size: 16px;
                  font-family:"SimHei";
                  /* font-weight: 500; */
              }
              .table-win tr td .b-border{
                  display:inline-block;
                  width: 30px;
                  border-bottom:1px solid #000;
              }
              .table-donwload-section label {
                  /* font-weight: 500; */
              }
              .table-win{
                /* border: 2px solid #000; */
              }

             .table-win tr td,
              .table-win tr th{
                font-size: 13.2px !important;
                height: 25px;
                width: 200px;
              }
              .table-win td div{
                text-align:center !important;
              }
              .tr-line1{
                height: 25px;
              }
              .tr-line4{
                height: 100px;
              }
              .table-body tr td .class-step{
                outline: none;
                border: none;
                display: inline-block;
                width: 20px;
                border-bottom:1px solid #000;
              }

              #contractTable,
              #witnessTable {
                width: 21cm;
                height: 29.7cm;
                background: white;
                margin: 0 auto;
                box-sizing: border-box;
              }
              #contractTable {
                padding: 0.6cm 0.6cm 0 0.6cm;
              }
              #witnessTable  {
                /* min-height: 26.7cm; */
                padding: 2cm 2cm 0cm 2.5cm;
              }

              @page {
              size: A4 portrait;
              margin: 0;
              }

              @media print {
                #witnessTable,
                #contractTable {
                  margin: 0;
                  border: initial;
                  border-radius: initial;
                  width: initial;
                  min-height: initial;
                  box-shadow: initial;
                  background: initial;
                  page-break-after: always;
                  overflow: hidden;
                }

                #contractTable .table-body {
                  font-size: 9px !important;
                  width: 100%;
                  table-layout: fixed;
                  word-break: break-all;
                  height: 736px;
                }
                #contractTable .td-label {
                width: 70px !important;
              }
                #witnessTable input,
                #contractTable input {
                 border:0 none black;
                }
              }

            </style>
            <!-- 测试图片 -->
            <!-- <img src="./images/a1.jpg" alt="" srcset="" crossorigin="anonymous"> -->
            <!-- <img src="./images/a1.jpg" alt="" srcset=""> -->

            <!-- 表头 -->
            <table class="table-header">
              __TABLE_HEADER__
            </table>
            <!-- 表体 -->
            <table class="table-body" align="center">
                __TABLE_BODY
            </table>
            <!-- 备注 -->
              <div
                class="table-desc"
                style="
                  font-size: 12px;
                  word-wrap: break-word;
                  margin: 10px 0;
                  text-align: left;
                "
              >
                __TABLE_DESC
              </div>
          </div>
        </script>
      </div>
    </div>
    <div style="visibility: hidden">
      <button type="button" class="print">打印</button>
      <button type="button" class="print1">打印1</button>
    </div>
    <!-- Vendor scripts -->
    <script src="vendor/jquery/dist/jquery.min.js"></script>
    <script src="vendor/jquery-ui/jquery-ui.min.js"></script>
    <script src="vendor/slimScroll/jquery.slimscroll.min.js"></script>
    <script src="vendor/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="vendor/metisMenu/dist/metisMenu.min.js"></script>
    <script src="vendor/iCheck/icheck.min.js"></script>
    <script src="vendor/sparkline/index.js"></script>
    <script src="vendor/moment/moment.js"></script>
    <script src="vendor/files/FileSaver.js"></script>
    <script src="vendor/files/jquery.wordexport.js"></script>
    <script src="vendor/bootstrap-datepicker-master/dist/js/bootstrap-datepicker.min.js"></script>
    <script src="vendor/clockpicker/dist/bootstrap-clockpicker.min.js"></script>
    <script src="vendor/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
    <script src="vendor/toastr/build/toastr.min.js"></script>
    <script src="vendor/jquery-validation/jquery.validate.min.js"></script>
    <script src="vendor/sweetalert/lib/sweet-alert.min.js"></script>

    <!-- App scripts -->
    <script src="scripts/jquery.base64.js"></script>
    <script src="scripts/jquery.jqprint-0.3.js"></script>
    <script src="scripts/homer.js"></script>
    <script src="scripts/dataToTable.js"></script>
    <script>
      // 解决打印报错
      jQuery.browser = {};
      (function () {
        jQuery.browser.msie = false;
        jQuery.browser.version = 0;
        if (navigator.userAgent.match(/MSIE ([0-9]+)./)) {
          jQuery.browser.msie = true;
          jQuery.browser.version = RegExp.$1;
        }
      })();
    </script>
    <script>
      var userInfo = getUserInfo() || {};
      var queryObj = query2obj(window.location.href);
      var isView = queryObj.type === "view"; // 查看状态

      var contractTable = $("#contractTable");
      var witnessTable = $("#witnessTable");
      contractTable.hide();
      witnessTable.hide();

      //   生成表格校验信息
      var loginForm1Map = {
        rules: {},
        messages: {},
      };
      var tableName = "";
      var tableNum = "";

      $(".print").click(function () {
        $("#mainWrapper").jqprint({
          debug: false, //如果是true则可以显示iframe查看效果，默认是false
          importCSS: true, //true表示引进原来的页面的css，默认是true。
          printContainer: true, //表示如果原来选择的对象必须被纳入打印，默认是true。
          operaSupport: true, ///表示如果插件也必须支持歌opera浏览器，默认是true。
        });
      });
      $(".print1").click(function () {
        window.print();
      });

      $.ajax({
        url: "http://meterial.cxhy.cn/getRecordDetail/",
        type: "GET",
        data: {
          id: queryObj.id,
          target_day: queryObj.target_day,
          qr_code_obj: {
            contract: "./qr-code.html?" + obj2query(queryObj) + "&witness=0",
            witness: "./qr-code.html?" + obj2query(queryObj) + "&witness=1",
          },
        },
        success: function (res) {
          if (res.code == 200) {
            var data = res.data;
            // 工程编号
            tableNum = data.numbers;
            tableName = data.title;
            document.title = tableName;
            $("#hbreadcrumb .active span").html(tableName);
            $("#loginForm1 .table-donwload-section .table-order").html(
              data.numbers
            );
            // title 信息
            $("#loginForm1 .table-donwload-section .table-title").html(
              data.title
            );

            // 表头信息
            if (queryObj.pritype == "0" && data.tableData) {
              $("#contractTable").show();
              // 计算下有多少列，重置下行高
              var len = 0;
              data.tableData.forEach(function (item) {
                // 如果是空表不在渲染
                if (Array.isArray(item.tableBody) && item.tableBody.length) {
                  dataToTable(item, "#loginForm1", loginForm1Map, data, true);
                }
              });
            }
            if (queryObj.pritype == "1" && data.witnessData) {
              $("#witnessTable").show();
              data.witnessData.tableData.forEach(function (item) {
                if (Array.isArray(item.tableBody) && item.tableBody.length) {
                  dataToTable(item, "#loginForm2", loginForm1Map, data, true);
                }
              });
            }
            // 二维码
            if (data.qrCode) {
              if (data.qrCode.contract) {
                $(".contract-code").parent().removeClass("hidden");
                $(".contract-code").attr("src", data.qrCode.contract);
                $("#loginForm1 .print-code").removeClass("hidden");
              }
              if (data.qrCode.witness) {
                $(".witness-code").attr("src", data.qrCode.witness);
              }
            }
            $(".print").click();
            //最后的错误信息
            res.msg && res.msg != "ok" && toastr && toastr.warning(res.msg);
          }
        },
      });
    </script>
  </body>
</html>
