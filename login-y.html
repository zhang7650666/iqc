<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  <!-- Page title -->
  <title>HOMER | WebApp admin theme</title>

  <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
  <!--<link rel="shortcut icon" type="image/ico" href="favicon.ico" />-->

  <!-- Vendor styles -->
  <link rel="stylesheet" href="vendor/fontawesome/css/font-awesome.css" />
  <link rel="stylesheet" href="vendor/metisMenu/dist/metisMenu.css" />
  <link rel="stylesheet" href="vendor/animate.css/animate.css" />
  <link rel="stylesheet" href="vendor/bootstrap/dist/css/bootstrap.css" />
  <link rel="stylesheet" href="vendor/toastr/build/toastr.min.css" />

  <!-- App styles -->
  <link rel="stylesheet" href="fonts/pe-icon-7-stroke/css/pe-icon-7-stroke.css" />
  <link rel="stylesheet" href="fonts/pe-icon-7-stroke/css/helper.css" />
  <link rel="stylesheet" href="styles/style.css" />
</head>

<body class="blank">
  <!--[if lt IE 7]>
      <p class="alert alert-danger">
        You are using an <strong>outdated</strong> browser. Please
        <a href="http://browsehappy.com/">upgrade your browser</a> to improve
        your experience.
      </p>
    <![endif]-->

  <!-- <div class="color-line"></div> -->

  <div class="login-container">
    <div class="row">
      <div class="col-md-12">
        <div class="text-center m-b-md">
          <h3>材料检验客户端</h3>
          <small>使用工程编号登录</small>
        </div>
        <div class="hpanel">
          <div class="panel-body">
            <form action="#" id="loginForm" class="form-horizontal">
              <div class="form-group">
                <label class="col-sm-3 control-label" for="project_cid">工程编号</label>
                <div class="col-sm-9">
                  <input type="text" placeholder="请输入工程编号" required="" value="" name="project_cid" id="project_cid"
                    class="form-control" />
                  <div class="error-block-project_cid text-danger"></div>
                </div>
              </div>
              <div id="pass-form-group" class="form-group hidden">
                <label class="col-sm-3 control-label" for="password">密码</label>
                <div class="col-sm-9">
                  <input type="password" placeholder="请输入密码" required="" value="" name="password" id="password"
                    class="form-control" />
                  <div class="error-block-password text-danger"></div>
                </div>
              </div>
              <div id="phone-form-group" class="hidden">
                <div class="form-group">
                  <label class="col-sm-3 control-label" for="phone_num">绑定手机号</label>
                  <div class="col-sm-9">
                    <input type="tel" placeholder="" required="" value="" name="phone_num" id="phone_num" class="form-control"
                      maxlength="11" />
                    <div class="error-block-phone_num text-danger"></div>
                  </div>
                </div>
                <div class="form-group">
                  <label class="col-sm-3 control-label" for="verify_code">验证码</label>
                  <div class="col-sm-9">
                    <div class="col-xs-8 p-l-none">
                      <input type="text" placeholder="" required="" value="" name="verify_code" id="verify_code"
                        class="form-control" maxlength="6" />
                    </div>
                    <div class="col-xs-4">
                      <button type="button" id="readPhoneCode" class="btn btn-link">
                        获取验证码
                      </button>
                    </div>
                    <div class="error-block-verify_code text-danger"></div>
                  </div>
                </div>
              </div>
              <!-- 初始选择的登录方式 -->
              <div class="row login-type-group p-b-xl">
                <div class="col-xs-6">
                  <button type="button" class="btn btn-info btn-block login-type-btn" data-type="phone_num">
                    手机验证登录
                  </button>
                </div>
                <div class="col-xs-6">
                  <button type="button" class="btn btn-info btn-block login-type-btn" data-type="pass">
                    密码登录
                  </button>
                </div>
                <div class="txt-center">
                  <a class="btn btn-link" href="./register-y.html">创建新的工程编号</a>
                </div>
              </div>
              <div class="row login-btn-group hidden p-t-lg">
                <div class="col-xs-6 col-xs-offset-3 p-b-sm">
                  <button class="btn btn-primary btn-block">登录系统</button>
                </div>
                <div class="col-xs-6 col-xs-offset-3 p-b-sm">
                  <button type="submit" class="btn btn-default btn-block btn-pass login-type-btn" data-type="pass">
                    密码登录
                  </button>
                  <button type="button" class="btn btn-default btn-block btn-phone login-type-btn" data-type="phone_num">
                    绑定手机登录
                  </button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <!-- <div class="row">
        <div class="col-md-12 text-center">
          <strong>HOMER</strong> - AngularJS Responsive WebApp <br />
          2015 Copyright Company Name
        </div>
      </div> -->
  </div>

  <!-- Vendor scripts -->
  <script src="vendor/jquery/dist/jquery.min.js"></script>
  <script src="vendor/jquery-ui/jquery-ui.min.js"></script>
  <script src="vendor/slimScroll/jquery.slimscroll.min.js"></script>
  <script src="vendor/bootstrap/dist/js/bootstrap.min.js"></script>
  <script src="vendor/metisMenu/dist/metisMenu.min.js"></script>
  <script src="vendor/iCheck/icheck.min.js"></script>
  <script src="vendor/sparkline/index.js"></script>
  <script src="vendor/jquery-validation/jquery.validate.min.js"></script>
  <script src="vendor/toastr/build/toastr.min.js"></script>

  <!-- App scripts -->
  <script src="scripts/homer.js"></script>
  <script>
    // 登录方式 pass；phone_num
    var loginType = "";
    var passKeys = ["passWord"];
    var phoneKeys = ["phone_num", "verify_code"];
    var phoneReg = /^[1][3,4,5,6,7,8,9][0-9]{9}$/;

    // toastr 提示配置
    toastr.options = {
      // debug: false,
      newestOnTop: false,
      positionClass: "toast-top-center",
      closeButton: true,
      showDuration: "100",
      hideDuration: "1000",
      timeOut: "3000",
      // toastClass: "animated fadeInDown",
    };

    // 切换登录方式
    $(".login-type-btn").on("click", function (e) {
      event.preventDefault();
      var type = $(this).data("type");
      loginType = type;
      // 切换登录方式
      if (type === "pass") {
        $("#pass-form-group").removeClass("hidden");
        $("#phone-form-group").addClass("hidden");
        $(".login-btn-group .btn-phone").removeClass("hidden");
        $(".login-btn-group .btn-pass").addClass("hidden");
        $(phoneKeys).each(function (index, ele) {
          $("#" + ele).val("");
        });
        
      } else {
        $("#phone-form-group").removeClass("hidden");
        $("#pass-form-group").addClass("hidden");
        $(".login-btn-group .btn-phone").addClass("hidden");
        $(".login-btn-group .btn-pass").removeClass("hidden");
        $(passKeys).each(function (index, ele) {
          $("#" + ele).val("");
        });
      }
      // 隐藏登录方式按钮
      $(".login-type-group").addClass("hidden");

      // 显示登录按钮
      $(".login-btn-group").removeClass("hidden");
    });

    // 提交校验

    $("#loginForm").validate({
      rules: {
        project_cid: {
          required: true,
          minlength: 6,
          maxlength: 20,
          // regex: "(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,10}$", //正则
        },
        password: {
          required: true,
        },
        phone_num: {
          required: true,
          isMobile: true
        },
        verify_code: {
          required: true,
          number: true,
          digits: true,
          minlength: 6,
          maxlength: 6,
        },
      },
      messages: {
        project_cid: {
          required: "请输入工程编号",
          minlength: "工程编号不能太短",
          maxlength: "工程编号不能太长",
          // regex:
          //   "密码必须包含大小写字母和数字的组合，不能使用特殊字符，长度在8-10之间",
        },
        password: {
          required: "请输入密码",
        },
        phone_num: {
          required: "请输入手机号码",
          isMobile: "请输入正确的手机号",
        },
        verify_code: {
          required: "请输入手机验证码",
          number: "只支持数字",
          digits: "不支持小数或负数",
          minlength: "请输入正确的验证码",
          maxlength: "请输入正确的验证码",
        },
      },
      onfocusout: false,
      // focusCleanup: true, // 当未通过验证的元素获得焦点时,并移除错误提示 （避免和 focusInvalid.一起使用）
      submitHandler: function (form) {
        var formData = {};
        var t = $(form).serializeArray();
        $.each(t, function () {
          if(this.value) {
            formData[this.name] = this.value
          }
        });
        console.log('formData', formData)
        formData.password = ''
        $.ajax({
          url: "http://meterial.cxhy.cn/login/",
          type: "POST",
          // processData: false,
          // cache: false,
          dataType: "json",
          contentType: 'application/json',
          data: JSON.stringify(formData),
          success: function (res) {
            //跳转至home页
          },
          error: function (error) {},
        });
      },
      errorPlacement: function (error, element) {
        var name = $(element).attr("name");
        $(".error-block-" + name).html(error);
      },
      errorElement: "p",
    });

    $("#readPhoneCode").on("click", function (e) {
      var val = $("index[type='phone_num']").val();
      if (!val || !phoneReg.test(val)) {
        toastr.warning("请先填写手机号");
        return;
      }
      $.ajax({
        url: "http://meterial.cxhy.cn/phone-code",
        type: "get",
        processData: false,
        cache: false,
        dataType: "json",
        data: {},
        success: function (res) {},
        error: function (error) {},
      });
    });
  </script>
</body>

</html>